From d22e16b8cf6ab5a3919d66f26d60f72b99081d74 Mon Sep 17 00:00:00 2001
From: Neal Gompa <ngompa13@gmail.com>
Date: Sun, 17 Sep 2017 02:03:02 +0000
Subject: [PATCH] ext: Ignore DistEpoch entirely

For now, we don't particularly care about DistEpoch, and would
rather ignore it, since DNF can't use it right now.
---
 ext/repo_mdk.c   | 6 ++++--
 ext/repo_rpmdb.c | 2 ++
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/ext/repo_mdk.c b/ext/repo_mdk.c
index 345d416..cb8be6f 100644
--- a/ext/repo_mdk.c
+++ b/ext/repo_mdk.c
@@ -183,15 +183,17 @@ repo_add_mdk(Repo *repo, FILE *fp, int flags)
 	      if (n && !strncmp(n + 1, disttag, strlen(disttag)))
 		*n = 0;
 	    }
+	  /* // Ignore DistEpoch entirely
 	  if (distepoch && *distepoch)
 	    {
-	      /* add distepoch */
+	      // add distepoch
 	      int le = strlen(distepoch);
 	      int ln = strlen(nvra);
 	      nvra[ln++] = ':';
-	      memmove(nvra + ln, distepoch, le);	/* may overlap */
+	      memmove(nvra + ln, distepoch, le);	// may overlap
 	      nvra[le + ln] = 0;
 	    }
+	   */
 	  version = strrchr(nvra, '-');
 	  if (version)
 	    {
diff --git a/ext/repo_rpmdb.c b/ext/repo_rpmdb.c
index 92aef31..28d6f06 100644
--- a/ext/repo_rpmdb.c
+++ b/ext/repo_rpmdb.c
@@ -384,6 +384,7 @@ static char *headtoevr(RpmHead *h)
       sprintf(evr, "%s-%s", version, release);
     }
   distepoch = headstring(h, TAG_DISTEPOCH);
+  /* //Ignore DistEpoch entirely
   if (distepoch && *distepoch)
     {
       int l = strlen(evr);
@@ -391,6 +392,7 @@ static char *headtoevr(RpmHead *h)
       evr[l++] = ':';
       strcpy(evr + l, distepoch);
     }
+   */
   return evr;
 }
 
-- 
2.14.1

